local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Settings = {
    ESP_Enabled = true,
    Box = true,
    Snaplines = true,
    Skeleton = true,
    Names = true,
    Distance = true,
    
    Chams_Enabled = true,
    Chams_Color = Color3.fromRGB(255, 0, 0),
    Chams_OutlineColor = Color3.fromRGB(255, 255, 255),
    Chams_FillTransparency = 0.5,
    Chams_OutlineTransparency = 0,
    Chams_Mode = "AlwaysOnTop",
    
    LocalChams_Enabled = true,
    LocalChams_Color = Color3.fromRGB(0, 255, 0),
    LocalChams_OutlineColor = Color3.fromRGB(255, 255, 255),
    LocalChams_FillTransparency = 0.3,
    LocalChams_Mode = "AlwaysOnTop",
    
    LocalCharChams_Enabled = false,
    LocalCharChams_Color = Color3.fromRGB(0, 150, 255),
    LocalCharChams_OutlineColor = Color3.fromRGB(255, 255, 255),
    LocalCharChams_FillTransparency = 0.5,
    
    Aimbot_Enabled = true,
    Aimbot_Key = Enum.KeyCode.Q,
    Aimbot_FOV = 150,
    Aimbot_Smoothness = 5,
    Aimbot_Hitbox = "Head",
    Aimbot_WallCheck = true,
    Aimbot_TargetLine = true,
    
    AutoFire_Enabled = false,
    
    RapidFire_Enabled = false,
    RapidFire_Multiplier = 5,
    
    NoReload_Enabled = false,
    
    SpinBot_Enabled = false,
    SpinBot_Speed = 10,
    
    FOV_Changer = 70,
    
    Nightmode = false,
    Nightmode_Brightness = 0.5,
    Nightmode_Color = Color3.fromRGB(50, 50, 80),
    
    Skybox_Enabled = false,
    Skybox_Color = Color3.fromRGB(0, 0, 50),
    
    Thirdperson_Enabled = false,
    Thirdperson_Key = Enum.KeyCode.T,
    Thirdperson_Distance = 10,
    
    InfiniteJump_Enabled = false,
    
    SpeedHack_Enabled = false,
    SpeedHack_Speed = 32,
    
    Fly_Enabled = false,
    Fly_Key = Enum.KeyCode.F,
    Fly_Speed = 50,
    
    Ghost_Enabled = false,
    
    Radar_Enabled = false,
    Radar_Size = 150,
    Radar_Zoom = 1,
    
    BoxColor = Color3.fromRGB(255, 0, 0),
    LineColor = Color3.fromRGB(0, 255, 0),
    SkeletonColor = Color3.fromRGB(255, 255, 255),
    TargetLineColor = Color3.fromRGB(255, 255, 0)
}

local MenuOpen = false
local aimbotActive = false
local ESPObjects = {}
local CurrentTarget = nil
local LocalCharHighlight = nil
local OriginalSky = nil
local CustomSky = nil

local flyActive = false
local flyBodyVelocity = nil
local flyBodyGyro = nil

local spinAngle = 0

local OriginalLighting = {
    Ambient = Lighting.Ambient,
    Brightness = Lighting.Brightness,
    ClockTime = Lighting.ClockTime,
    FogEnd = Lighting.FogEnd,
    FogColor = Lighting.FogColor,
    GlobalShadows = Lighting.GlobalShadows,
    OutdoorAmbient = Lighting.OutdoorAmbient
}

OriginalSky = Lighting:FindFirstChildOfClass("Sky")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "OpusLose"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Name = "Main"
MainFrame.Size = UDim2.new(0, 580, 0, 550)
MainFrame.Position = UDim2.new(0.5, -290, 0.5, -275)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Visible = false
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 8)
Corner.Parent = MainFrame

local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 35)
TitleBar.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

local TitleFix = Instance.new("Frame")
TitleFix.Size = UDim2.new(1, 0, 0, 10)
TitleFix.Position = UDim2.new(0, 0, 1, -10)
TitleFix.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
TitleFix.BorderSizePixel = 0
TitleFix.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "OpusLose v6 Ultimate"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = TitleBar

local dragging = false
local dragStart = nil
local startPos = nil

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

local TabHolder = Instance.new("Frame")
TabHolder.Size = UDim2.new(1, -20, 0, 30)
TabHolder.Position = UDim2.new(0, 10, 0, 45)
TabHolder.BackgroundTransparency = 1
TabHolder.Parent = MainFrame

local ContentHolder = Instance.new("Frame")
ContentHolder.Size = UDim2.new(1, -20, 1, -90)
ContentHolder.Position = UDim2.new(0, 10, 0, 80)
ContentHolder.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ContentHolder.BorderSizePixel = 0
ContentHolder.ClipsDescendants = true
ContentHolder.Parent = MainFrame

local ContentCorner = Instance.new("UICorner")
ContentCorner.CornerRadius = UDim.new(0, 6)
ContentCorner.Parent = ContentHolder

local Tabs = {}
local TabContents = {}

local function CreateTab(name)
    local tabButton = Instance.new("TextButton")
    tabButton.Size = UDim2.new(0, 65, 1, 0)
    tabButton.Position = UDim2.new(0, #Tabs * 68, 0, 0)
    tabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    tabButton.Text = name
    tabButton.TextColor3 = Color3.new(1, 1, 1)
    tabButton.Font = Enum.Font.Gotham
    tabButton.TextSize = 10
    tabButton.Parent = TabHolder
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 4)
    tabCorner.Parent = tabButton
    
    local content = Instance.new("ScrollingFrame")
    content.Size = UDim2.new(1, -10, 1, -10)
    content.Position = UDim2.new(0, 5, 0, 5)
    content.BackgroundTransparency = 1
    content.ScrollBarThickness = 4
    content.ScrollBarImageColor3 = Color3.fromRGB(128, 0, 128)
    content.Visible = false
    content.CanvasSize = UDim2.new(0, 0, 0, 0)
    content.Parent = ContentHolder
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 5)
    layout.Parent = content
    
    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        content.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 10)
    end)
    
    table.insert(Tabs, tabButton)
    TabContents[name] = content
    
    tabButton.MouseButton1Click:Connect(function()
        for _, tab in pairs(Tabs) do
            tab.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        end
        for _, cont in pairs(TabContents) do
            cont.Visible = false
        end
        tabButton.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
        content.Visible = true
    end)
    
    return content
end

local function CreateToggle(parent, name, default, callback)
    local Toggle = Instance.new("TextButton")
    Toggle.Size = UDim2.new(1, -10, 0, 28)
    Toggle.BackgroundColor3 = default and Color3.fromRGB(0, 120, 0) or Color3.fromRGB(120, 0, 0)
    Toggle.Text = "  " .. name
    Toggle.TextColor3 = Color3.new(1, 1, 1)
    Toggle.Font = Enum.Font.Gotham
    Toggle.TextSize = 12
    Toggle.TextXAlignment = Enum.TextXAlignment.Left
    Toggle.Parent = parent
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 4)
    ToggleCorner.Parent = Toggle
    
    local state = default
    Toggle.MouseButton1Click:Connect(function()
        state = not state
        Toggle.BackgroundColor3 = state and Color3.fromRGB(0, 120, 0) or Color3.fromRGB(120, 0, 0)
        callback(state)
    end)
    
    return Toggle
end

local function CreateSlider(parent, name, min, max, default, decimals, callback)
    local SliderFrame = Instance.new("Frame")
    SliderFrame.Size = UDim2.new(1, -10, 0, 50)
    SliderFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    SliderFrame.Parent = parent
    
    local SliderCorner = Instance.new("UICorner")
    SliderCorner.CornerRadius = UDim.new(0, 4)
    SliderCorner.Parent = SliderFrame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -10, 0, 20)
    Label.Position = UDim2.new(0, 5, 0, 5)
    Label.BackgroundTransparency = 1
    Label.Text = name .. ": " .. tostring(default)
    Label.TextColor3 = Color3.new(1, 1, 1)
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 11
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = SliderFrame
    
    local SliderBG = Instance.new("Frame")
    SliderBG.Size = UDim2.new(1, -20, 0, 16)
    SliderBG.Position = UDim2.new(0, 10, 0, 28)
    SliderBG.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    SliderBG.Parent = SliderFrame
    
    local SliderBGCorner = Instance.new("UICorner")
    SliderBGCorner.CornerRadius = UDim.new(0, 6)
    SliderBGCorner.Parent = SliderBG
    
    local initialFill = math.clamp((default - min) / (max - min), 0, 1)
    
    local SliderFill = Instance.new("Frame")
    SliderFill.Size = UDim2.new(initialFill, 0, 1, 0)
    SliderFill.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
    SliderFill.BorderSizePixel = 0
    SliderFill.Parent = SliderBG
    
    local SliderFillCorner = Instance.new("UICorner")
    SliderFillCorner.CornerRadius = UDim.new(0, 6)
    SliderFillCorner.Parent = SliderFill
    
    local SliderKnob = Instance.new("Frame")
    SliderKnob.Size = UDim2.new(0, 12, 0, 20)
    SliderKnob.AnchorPoint = Vector2.new(0.5, 0.5)
    SliderKnob.Position = UDim2.new(initialFill, 0, 0.5, 0)
    SliderKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    SliderKnob.Parent = SliderBG
    
    local SliderKnobCorner = Instance.new("UICorner")
    SliderKnobCorner.CornerRadius = UDim.new(0, 4)
    SliderKnobCorner.Parent = SliderKnob
    
    local sliderDragging = false
    
    local function UpdateSlider(inputX)
        local relativePos = math.clamp((inputX - SliderBG.AbsolutePosition.X) / SliderBG.AbsoluteSize.X, 0, 1)
        SliderFill.Size = UDim2.new(relativePos, 0, 1, 0)
        SliderKnob.Position = UDim2.new(relativePos, 0, 0.5, 0)
        
        local rawValue = min + (max - min) * relativePos
        local currentValue
        if decimals == 0 then
            currentValue = math.floor(rawValue + 0.5)
        else
            currentValue = math.floor(rawValue * (10 ^ decimals) + 0.5) / (10 ^ decimals)
        end
        
        Label.Text = name .. ": " .. tostring(currentValue)
        callback(currentValue)
    end
    
    SliderBG.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            sliderDragging = true
            UpdateSlider(input.Position.X)
        end
    end)
    
    SliderKnob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            sliderDragging = true
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if sliderDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            UpdateSlider(input.Position.X)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            sliderDragging = false
        end
    end)
    
    return SliderFrame
end

local function CreateKeybind(parent, name, default, callback)
    local KeybindFrame = Instance.new("Frame")
    KeybindFrame.Size = UDim2.new(1, -10, 0, 28)
    KeybindFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    KeybindFrame.Parent = parent
    
    local KeybindCorner = Instance.new("UICorner")
    KeybindCorner.CornerRadius = UDim.new(0, 4)
    KeybindCorner.Parent = KeybindFrame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.6, 0, 1, 0)
    Label.Position = UDim2.new(0, 5, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Color3.new(1, 1, 1)
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 12
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = KeybindFrame
    
    local KeyButton = Instance.new("TextButton")
    KeyButton.Size = UDim2.new(0.35, 0, 0.8, 0)
    KeyButton.Position = UDim2.new(0.62, 0, 0.1, 0)
    KeyButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    KeyButton.Text = default.Name
    KeyButton.TextColor3 = Color3.new(1, 1, 1)
    KeyButton.Font = Enum.Font.Gotham
    KeyButton.TextSize = 11
    KeyButton.Parent = KeybindFrame
    
    local KeyButtonCorner = Instance.new("UICorner")
    KeyButtonCorner.CornerRadius = UDim.new(0, 4)
    KeyButtonCorner.Parent = KeyButton
    
    local waiting = false
    KeyButton.MouseButton1Click:Connect(function()
        KeyButton.Text = "..."
        waiting = true
    end)
    
    UserInputService.InputBegan:Connect(function(input, processed)
        if waiting and input.UserInputType == Enum.UserInputType.Keyboard then
            KeyButton.Text = input.KeyCode.Name
            callback(input.KeyCode)
            waiting = false
        end
    end)
    
    return KeybindFrame
end

local function CreateDropdown(parent, name, options, default, callback)
    local DropdownFrame = Instance.new("Frame")
    DropdownFrame.Size = UDim2.new(1, -10, 0, 28)
    DropdownFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    DropdownFrame.ClipsDescendants = false
    DropdownFrame.ZIndex = 5
    DropdownFrame.Parent = parent
    
    local DropdownCorner = Instance.new("UICorner")
    DropdownCorner.CornerRadius = UDim.new(0, 4)
    DropdownCorner.Parent = DropdownFrame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.5, 0, 0, 28)
    Label.Position = UDim2.new(0, 5, 0, 0)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Color3.new(1, 1, 1)
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 12
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.ZIndex = 5
    Label.Parent = DropdownFrame
    
    local SelectedButton = Instance.new("TextButton")
    SelectedButton.Size = UDim2.new(0.45, 0, 0, 24)
    SelectedButton.Position = UDim2.new(0.52, 0, 0, 2)
    SelectedButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    SelectedButton.Text = default
    SelectedButton.TextColor3 = Color3.new(1, 1, 1)
    SelectedButton.Font = Enum.Font.Gotham
    SelectedButton.TextSize = 11
    SelectedButton.ZIndex = 5
    SelectedButton.Parent = DropdownFrame
    
    local SelectedCorner = Instance.new("UICorner")
    SelectedCorner.CornerRadius = UDim.new(0, 4)
    SelectedCorner.Parent = SelectedButton
    
    local OptionsFrame = Instance.new("Frame")
    OptionsFrame.Size = UDim2.new(0.45, 0, 0, #options * 24)
    OptionsFrame.Position = UDim2.new(0.52, 0, 0, 28)
    OptionsFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    OptionsFrame.Visible = false
    OptionsFrame.ZIndex = 10
    OptionsFrame.Parent = DropdownFrame
    
    local OptionsCorner = Instance.new("UICorner")
    OptionsCorner.CornerRadius = UDim.new(0, 4)
    OptionsCorner.Parent = OptionsFrame
    
    local OptionsLayout = Instance.new("UIListLayout")
    OptionsLayout.Parent = OptionsFrame
    
    local isOpen = false
    
    for _, option in ipairs(options) do
        local OptionButton = Instance.new("TextButton")
        OptionButton.Size = UDim2.new(1, 0, 0, 24)
        OptionButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        OptionButton.BackgroundTransparency = 0.3
        OptionButton.Text = option
        OptionButton.TextColor3 = Color3.new(1, 1, 1)
        OptionButton.Font = Enum.Font.Gotham
        OptionButton.TextSize = 11
        OptionButton.ZIndex = 11
        OptionButton.Parent = OptionsFrame
        
        OptionButton.MouseButton1Click:Connect(function()
            SelectedButton.Text = option
            callback(option)
            isOpen = false
            OptionsFrame.Visible = false
        end)
    end
    
    SelectedButton.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        OptionsFrame.Visible = isOpen
    end)
    
    return DropdownFrame
end

local function CreateColorPicker(parent, name, default, callback)
    local ColorFrame = Instance.new("Frame")
    ColorFrame.Size = UDim2.new(1, -10, 0, 100)
    ColorFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    ColorFrame.ClipsDescendants = true
    ColorFrame.Parent = parent
    
    local ColorCorner = Instance.new("UICorner")
    ColorCorner.CornerRadius = UDim.new(0, 4)
    ColorCorner.Parent = ColorFrame
    
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.5, 0, 0, 20)
    Label.Position = UDim2.new(0, 5, 0, 5)
    Label.BackgroundTransparency = 1
    Label.Text = name
    Label.TextColor3 = Color3.new(1, 1, 1)
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 11
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = ColorFrame
    
    local ColorPreview = Instance.new("Frame")
    ColorPreview.Size = UDim2.new(0, 50, 0, 20)
    ColorPreview.Position = UDim2.new(1, -60, 0, 5)
    ColorPreview.BackgroundColor3 = default
    ColorPreview.Parent = ColorFrame
    
    local PreviewCorner = Instance.new("UICorner")
    PreviewCorner.CornerRadius = UDim.new(0, 4)
    PreviewCorner.Parent = ColorPreview
    
    local HSPicker = Instance.new("Frame")
    HSPicker.Size = UDim2.new(0, 150, 0, 50)
    HSPicker.Position = UDim2.new(0, 10, 0, 30)
    HSPicker.BackgroundColor3 = Color3.new(1, 1, 1)
    HSPicker.Parent = ColorFrame
    
    local HSCorner = Instance.new("UICorner")
    HSCorner.CornerRadius = UDim.new(0, 4)
    HSCorner.Parent = HSPicker
    
    local HSGradient = Instance.new("UIGradient")
    HSGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
        ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 255, 0)),
        ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
        ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 0, 255)),
        ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 0, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
    })
    HSGradient.Parent = HSPicker
    
    local HSCursor = Instance.new("Frame")
    HSCursor.Size = UDim2.new(0, 8, 0, 8)
    HSCursor.AnchorPoint = Vector2.new(0.5, 0.5)
    HSCursor.Position = UDim2.new(0.5, 0, 0.5, 0)
    HSCursor.BackgroundColor3 = Color3.new(1, 1, 1)
    HSCursor.BorderSizePixel = 2
    HSCursor.BorderColor3 = Color3.new(0, 0, 0)
    HSCursor.Parent = HSPicker
    
    local HSCursorCorner = Instance.new("UICorner")
    HSCursorCorner.CornerRadius = UDim.new(1, 0)
    HSCursorCorner.Parent = HSCursor
    
    local BrightnessBar = Instance.new("Frame")
    BrightnessBar.Size = UDim2.new(0, 20, 0, 50)
    BrightnessBar.Position = UDim2.new(0, 170, 0, 30)
    BrightnessBar.BackgroundColor3 = Color3.new(1, 1, 1)
    BrightnessBar.Parent = ColorFrame
    
    local BrightnessCorner = Instance.new("UICorner")
    BrightnessCorner.CornerRadius = UDim.new(0, 4)
    BrightnessCorner.Parent = BrightnessBar
    
    local BrightnessGradient = Instance.new("UIGradient")
    BrightnessGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
        ColorSequenceKeypoint.new(1, Color3.new(0, 0, 0))
    })
    BrightnessGradient.Rotation = 90
    BrightnessGradient.Parent = BrightnessBar
    
    local BrightnessCursor = Instance.new("Frame")
    BrightnessCursor.Size = UDim2.new(1, 4, 0, 4)
    BrightnessCursor.AnchorPoint = Vector2.new(0.5, 0.5)
    BrightnessCursor.Position = UDim2.new(0.5, 0, 0.5, 0)
    BrightnessCursor.BackgroundColor3 = Color3.new(1, 1, 1)
    BrightnessCursor.BorderSizePixel = 1
    BrightnessCursor.BorderColor3 = Color3.new(0, 0, 0)
    BrightnessCursor.Parent = BrightnessBar
    
    local currentH, currentS, currentV = Color3.toHSV(default)
    
    local function UpdateColor()
        local newColor = Color3.fromHSV(currentH, currentS, currentV)
        ColorPreview.BackgroundColor3 = newColor
        callback(newColor)
    end
    
    local hsDragging = false
    local brightDragging = false
    
    HSPicker.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            hsDragging = true
            local relX = math.clamp((input.Position.X - HSPicker.AbsolutePosition.X) / HSPicker.AbsoluteSize.X, 0, 1)
            local relY = math.clamp((input.Position.Y - HSPicker.AbsolutePosition.Y) / HSPicker.AbsoluteSize.Y, 0, 1)
            currentH = relX
            currentS = 1 - relY
            HSCursor.Position = UDim2.new(relX, 0, relY, 0)
            UpdateColor()
        end
    end)
    
    BrightnessBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            brightDragging = true
            local relY = math.clamp((input.Position.Y - BrightnessBar.AbsolutePosition.Y) / BrightnessBar.AbsoluteSize.Y, 0, 1)
            currentV = 1 - relY
            BrightnessCursor.Position = UDim2.new(0.5, 0, relY, 0)
            UpdateColor()
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            if hsDragging then
                local relX = math.clamp((input.Position.X - HSPicker.AbsolutePosition.X) / HSPicker.AbsoluteSize.X, 0, 1)
                local relY = math.clamp((input.Position.Y - HSPicker.AbsolutePosition.Y) / HSPicker.AbsoluteSize.Y, 0, 1)
                currentH = relX
                currentS = 1 - relY
                HSCursor.Position = UDim2.new(relX, 0, relY, 0)
                UpdateColor()
            elseif brightDragging then
                local relY = math.clamp((input.Position.Y - BrightnessBar.AbsolutePosition.Y) / BrightnessBar.AbsoluteSize.Y, 0, 1)
                currentV = 1 - relY
                BrightnessCursor.Position = UDim2.new(0.5, 0, relY, 0)
                UpdateColor()
            end
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            hsDragging = false
            brightDragging = false
        end
    end)
    
    return ColorFrame
end

local function CreateLabel(parent, text)
    local LabelFrame = Instance.new("TextLabel")
    LabelFrame.Size = UDim2.new(1, -10, 0, 20)
    LabelFrame.BackgroundTransparency = 1
    LabelFrame.Text = text
    LabelFrame.TextColor3 = Color3.fromRGB(180, 180, 180)
    LabelFrame.Font = Enum.Font.GothamBold
    LabelFrame.TextSize = 11
    LabelFrame.TextXAlignment = Enum.TextXAlignment.Left
    LabelFrame.Parent = parent
    return LabelFrame
end

local AimbotTab = CreateTab("Aimbot")
local ESPTab = CreateTab("ESP")
local ChamsTab = CreateTab("Chams")
local VisualsTab = CreateTab("Visuals")
local MovementTab = CreateTab("Move")
local WeaponTab = CreateTab("Weapon")
local MiscTab = CreateTab("Misc")
local RadarTab = CreateTab("Radar")

CreateLabel(AimbotTab, "-- Aimbot Settings --")
CreateToggle(AimbotTab, "Enable Aimbot", Settings.Aimbot_Enabled, function(v) Settings.Aimbot_Enabled = v end)
CreateToggle(AimbotTab, "Wall Check", Settings.Aimbot_WallCheck, function(v) Settings.Aimbot_WallCheck = v end)
CreateToggle(AimbotTab, "Target Line", Settings.Aimbot_TargetLine, function(v) Settings.Aimbot_TargetLine = v end)
CreateToggle(AimbotTab, "Auto Fire", Settings.AutoFire_Enabled, function(v) Settings.AutoFire_Enabled = v end)
CreateKeybind(AimbotTab, "Aimbot Key", Settings.Aimbot_Key, function(v) Settings.Aimbot_Key = v end)
CreateDropdown(AimbotTab, "Hitbox", {"Head", "Chest", "Nearest"}, Settings.Aimbot_Hitbox, function(v) Settings.Aimbot_Hitbox = v end)
CreateSlider(AimbotTab, "FOV Size", 50, 500, Settings.Aimbot_FOV, 0, function(v) Settings.Aimbot_FOV = v end)
CreateSlider(AimbotTab, "Smoothness", 1, 20, Settings.Aimbot_Smoothness, 1, function(v) Settings.Aimbot_Smoothness = v end)
CreateLabel(AimbotTab, "-- Risky Features --")
CreateToggle(AimbotTab, "SpinBot [RISK]", Settings.SpinBot_Enabled, function(v) Settings.SpinBot_Enabled = v end)
CreateSlider(AimbotTab, "SpinBot Speed", 1, 50, Settings.SpinBot_Speed, 0, function(v) Settings.SpinBot_Speed = v end)

CreateToggle(ESPTab, "Enable ESP", Settings.ESP_Enabled, function(v) Settings.ESP_Enabled = v end)
CreateToggle(ESPTab, "Box", Settings.Box, function(v) Settings.Box = v end)
CreateToggle(ESPTab, "Snaplines", Settings.Snaplines, function(v) Settings.Snaplines = v end)
CreateToggle(ESPTab, "Skeleton", Settings.Skeleton, function(v) Settings.Skeleton = v end)
CreateToggle(ESPTab, "Names", Settings.Names, function(v) Settings.Names = v end)
CreateToggle(ESPTab, "Distance", Settings.Distance, function(v) Settings.Distance = v end)

CreateToggle(ChamsTab, "Enemy Chams", Settings.Chams_Enabled, function(v) Settings.Chams_Enabled = v end)
CreateDropdown(ChamsTab, "Enemy Mode", {"AlwaysOnTop", "Occluded", "Normal"}, Settings.Chams_Mode, function(v) Settings.Chams_Mode = v end)
CreateColorPicker(ChamsTab, "Enemy Fill", Settings.Chams_Color, function(v) Settings.Chams_Color = v end)
CreateColorPicker(ChamsTab, "Enemy Outline", Settings.Chams_OutlineColor, function(v) Settings.Chams_OutlineColor = v end)
CreateSlider(ChamsTab, "Enemy Transparency", 0, 1, Settings.Chams_FillTransparency, 2, function(v) Settings.Chams_FillTransparency = v end)
CreateToggle(ChamsTab, "Local Arms Chams", Settings.LocalChams_Enabled, function(v) Settings.LocalChams_Enabled = v end)
CreateColorPicker(ChamsTab, "Arms Fill", Settings.LocalChams_Color, function(v) Settings.LocalChams_Color = v end)
CreateToggle(ChamsTab, "Local Character Chams", Settings.LocalCharChams_Enabled, function(v) Settings.LocalCharChams_Enabled = v end)
CreateColorPicker(ChamsTab, "Character Fill", Settings.LocalCharChams_Color, function(v) Settings.LocalCharChams_Color = v end)

CreateSlider(VisualsTab, "Field of View", 30, 120, Settings.FOV_Changer, 0, function(v) Settings.FOV_Changer = v end)
CreateToggle(VisualsTab, "Nightmode", Settings.Nightmode, function(v) Settings.Nightmode = v end)
CreateSlider(VisualsTab, "Nightmode Brightness", 0, 2, Settings.Nightmode_Brightness, 2, function(v) Settings.Nightmode_Brightness = v end)
CreateColorPicker(VisualsTab, "Nightmode Color", Settings.Nightmode_Color, function(v) Settings.Nightmode_Color = v end)
CreateToggle(VisualsTab, "Custom Skybox", Settings.Skybox_Enabled, function(v) Settings.Skybox_Enabled = v end)
CreateColorPicker(VisualsTab, "Skybox Color", Settings.Skybox_Color, function(v) Settings.Skybox_Color = v end)

CreateToggle(MovementTab, "Infinite Jump", Settings.InfiniteJump_Enabled, function(v) Settings.InfiniteJump_Enabled = v end)
CreateToggle(MovementTab, "Speed Hack [RISK]", Settings.SpeedHack_Enabled, function(v) Settings.SpeedHack_Enabled = v end)
CreateSlider(MovementTab, "Walk Speed", 16, 200, Settings.SpeedHack_Speed, 0, function(v) Settings.SpeedHack_Speed = v end)
CreateToggle(MovementTab, "Fly [RISK]", Settings.Fly_Enabled, function(v) 
    Settings.Fly_Enabled = v 
    if not v and flyActive then
        flyActive = false
        StopFly()
    end
end)
CreateKeybind(MovementTab, "Fly Key", Settings.Fly_Key, function(v) Settings.Fly_Key = v end)
CreateSlider(MovementTab, "Fly Speed", 10, 200, Settings.Fly_Speed, 0, function(v) Settings.Fly_Speed = v end)
CreateToggle(MovementTab, "Ghost (Noclip) [RISK]", Settings.Ghost_Enabled, function(v) Settings.Ghost_Enabled = v end)

CreateLabel(WeaponTab, "-- Weapon Modifications --")
CreateToggle(WeaponTab, "Rapid Fire [RISK]", Settings.RapidFire_Enabled, function(v) Settings.RapidFire_Enabled = v end)
CreateSlider(WeaponTab, "Rapid Fire Multiplier", 2, 20, Settings.RapidFire_Multiplier, 0, function(v) Settings.RapidFire_Multiplier = v end)
CreateToggle(WeaponTab, "No Reload [RISK]", Settings.NoReload_Enabled, function(v) Settings.NoReload_Enabled = v end)

CreateToggle(MiscTab, "Thirdperson", Settings.Thirdperson_Enabled, function(v) 
    Settings.Thirdperson_Enabled = v 
    if v then
        local player = LocalPlayer
        player.CameraMinZoomDistance = Settings.Thirdperson_Distance
        player.CameraMaxZoomDistance = Settings.Thirdperson_Distance
    else
        local player = LocalPlayer
        player.CameraMinZoomDistance = 0.5
        player.CameraMaxZoomDistance = 400
    end
end)
CreateKeybind(MiscTab, "Thirdperson Key", Settings.Thirdperson_Key, function(v) Settings.Thirdperson_Key = v end)
CreateSlider(MiscTab, "Thirdperson Distance", 5, 25, Settings.Thirdperson_Distance, 0, function(v) 
    Settings.Thirdperson_Distance = v 
    if Settings.Thirdperson_Enabled then
        LocalPlayer.CameraMinZoomDistance = v
        LocalPlayer.CameraMaxZoomDistance = v
    end
end)

CreateLabel(RadarTab, "-- Radar Settings --")
CreateToggle(RadarTab, "Enable Radar", Settings.Radar_Enabled, function(v) Settings.Radar_Enabled = v end)
CreateSlider(RadarTab, "Radar Size", 100, 300, Settings.Radar_Size, 0, function(v) Settings.Radar_Size = v end)
CreateSlider(RadarTab, "Radar Zoom", 0.5, 3, Settings.Radar_Zoom, 1, function(v) Settings.Radar_Zoom = v end)

Tabs[1].BackgroundColor3 = Color3.fromRGB(128, 0, 128)
TabContents["Aimbot"].Visible = true

local RadarFrame = Instance.new("Frame")
RadarFrame.Name = "Radar"
RadarFrame.Size = UDim2.new(0, Settings.Radar_Size, 0, Settings.Radar_Size)
RadarFrame.Position = UDim2.new(1, -Settings.Radar_Size - 10, 0, 10)
RadarFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
RadarFrame.BackgroundTransparency = 0.3
RadarFrame.BorderSizePixel = 2
RadarFrame.BorderColor3 = Color3.fromRGB(128, 0, 128)
RadarFrame.Visible = false
RadarFrame.Parent = ScreenGui

local RadarCorner = Instance.new("UICorner")
RadarCorner.CornerRadius = UDim.new(0, 8)
RadarCorner.Parent = RadarFrame

local RadarCenter = Instance.new("Frame")
RadarCenter.Size = UDim2.new(0, 6, 0, 6)
RadarCenter.Position = UDim2.new(0.5, -3, 0.5, -3)
RadarCenter.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
RadarCenter.BorderSizePixel = 0
RadarCenter.Parent = RadarFrame

local RadarCenterCorner = Instance.new("UICorner")
RadarCenterCorner.CornerRadius = UDim.new(1, 0)
RadarCenterCorner.Parent = RadarCenter

local RadarDots = {}

local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Color3.fromRGB(255, 255, 255)
FOVCircle.Thickness = 1
FOVCircle.Filled = false
FOVCircle.Visible = false

local TargetLine = Drawing.new("Line")
TargetLine.Color = Settings.TargetLineColor
TargetLine.Thickness = 1
TargetLine.Visible = false

local RayParams = RaycastParams.new()
RayParams.FilterType = Enum.RaycastFilterType.Blacklist

local function IsVisible(targetPart)
    if not Settings.Aimbot_WallCheck then return true end
    
    local character = LocalPlayer.Character
    if not character then return false end
    
    local head = character:FindFirstChild("Head")
    if not head then return false end
    
    RayParams.FilterDescendantsInstances = {character, Camera}
    
    local origin = head.Position
    local direction = (targetPart.Position - origin)
    local result = Workspace:Raycast(origin, direction, RayParams)
    
    if result then
        if result.Instance:IsDescendantOf(targetPart.Parent) then
            return true
        end
        return false
    end
    
    return true
end

local function GetBoneConnections()
    return {
        {"Head", "UpperTorso"},
        {"UpperTorso", "LowerTorso"},
        {"UpperTorso", "LeftUpperArm"},
        {"LeftUpperArm", "LeftLowerArm"},
        {"LeftLowerArm", "LeftHand"},
        {"UpperTorso", "RightUpperArm"},
        {"RightUpperArm", "RightLowerArm"},
        {"RightLowerArm", "RightHand"},
        {"LowerTorso", "LeftUpperLeg"},
        {"LeftUpperLeg", "LeftLowerLeg"},
        {"LeftLowerLeg", "LeftFoot"},
        {"LowerTorso", "RightUpperLeg"},
        {"RightUpperLeg", "RightLowerLeg"},
        {"RightLowerLeg", "RightFoot"}
    }
end

local function GetR6BoneConnections()
    return {
        {"Head", "Torso"},
        {"Torso", "Left Arm"},
        {"Torso", "Right Arm"},
        {"Torso", "Left Leg"},
        {"Torso", "Right Leg"}
    }
end

local function GetDepthMode(mode)
    if mode == "AlwaysOnTop" then
        return Enum.HighlightDepthMode.AlwaysOnTop
    elseif mode == "Occluded" then
        return Enum.HighlightDepthMode.Occluded
    else
        return Enum.HighlightDepthMode.AlwaysOnTop
    end
end

local function CreateESP(player)
    if player == LocalPlayer then return end
    
    local esp = {
        Box = Drawing.new("Square"),
        Snapline = Drawing.new("Line"),
        Name = Drawing.new("Text"),
        DistText = Drawing.new("Text"),
        Bones = {},
        Chams = nil
    }
    
    esp.Box.Color = Settings.BoxColor
    esp.Box.Thickness = 1
    esp.Box.Filled = false
    esp.Box.Visible = false
    
    esp.Snapline.Color = Settings.LineColor
    esp.Snapline.Thickness = 1
    esp.Snapline.Visible = false
    
    esp.Name.Color = Color3.new(1, 1, 1)
    esp.Name.Size = 13
    esp.Name.Center = true
    esp.Name.Outline = true
    esp.Name.Visible = false
    
    esp.DistText.Color = Color3.new(1, 1, 1)
    esp.DistText.Size = 12
    esp.DistText.Center = true
    esp.DistText.Outline = true
    esp.DistText.Visible = false
    
    for i = 1, 14 do
        local bone = Drawing.new("Line")
        bone.Color = Settings.SkeletonColor
        bone.Thickness = 1
        bone.Visible = false
        table.insert(esp.Bones, bone)
    end
    
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESPChams"
    highlight.FillColor = Settings.Chams_Color
    highlight.OutlineColor = Settings.Chams_OutlineColor
    highlight.FillTransparency = Settings.Chams_FillTransparency
    highlight.OutlineTransparency = Settings.Chams_OutlineTransparency
    highlight.DepthMode = GetDepthMode(Settings.Chams_Mode)
    esp.Chams = highlight
    
    ESPObjects[player] = esp
end

local function UpdateESP()
    local myChar = LocalPlayer.Character
    local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")
    
    for player, esp in pairs(ESPObjects) do
        if not player or not player.Parent then
            pcall(function()
                for _, v in pairs(esp.Bones) do v:Remove() end
                esp.Box:Remove()
                esp.Snapline:Remove()
                esp.Name:Remove()
                esp.DistText:Remove()
                if esp.Chams then esp.Chams:Destroy() end
            end)
            ESPObjects[player] = nil
            continue
        end
        
        local character = player.Character
        local rootPart = character and character:FindFirstChild("HumanoidRootPart")
        local humanoid = character and character:FindFirstChild("Humanoid")
        local head = character and character:FindFirstChild("Head")
        
        if character and rootPart and humanoid and humanoid.Health > 0 then
            local distance = myRoot and (myRoot.Position - rootPart.Position).Magnitude or 0
            
            if esp.Chams then
                esp.Chams.FillColor = Settings.Chams_Color
                esp.Chams.OutlineColor = Settings.Chams_OutlineColor
                esp.Chams.FillTransparency = Settings.Chams_FillTransparency
                esp.Chams.OutlineTransparency = Settings.Chams_OutlineTransparency
                esp.Chams.DepthMode = GetDepthMode(Settings.Chams_Mode)
            end
            
            if Settings.Chams_Enabled then
                esp.Chams.Adornee = character
                esp.Chams.Parent = character
            else
                esp.Chams.Adornee = nil
                esp.Chams.Parent = nil
            end
            
            if Settings.ESP_Enabled then
                local headPos, headOnScreen = Camera:WorldToViewportPoint(head and head.Position or rootPart.Position)
                local rootPos, rootOnScreen = Camera:WorldToViewportPoint(rootPart.Position)
                
                if headOnScreen then
                    local scaleFactor = 1 / (headPos.Z * math.tan(math.rad(Camera.FieldOfView / 2)) * 2) * 1000
                    local boxWidth = scaleFactor * 2.5
                    local boxHeight = scaleFactor * 5.5
                    
                    if Settings.Box then
                        esp.Box.Size = Vector2.new(boxWidth, boxHeight)
                        esp.Box.Position = Vector2.new(headPos.X - boxWidth / 2, headPos.Y - boxHeight * 0.15)
                        esp.Box.Visible = true
                    else
                        esp.Box.Visible = false
                    end
                    
                    if Settings.Names and head then
                        esp.Name.Text = player.Name
                        esp.Name.Position = Vector2.new(headPos.X, headPos.Y - boxHeight * 0.15 - 15)
                        esp.Name.Visible = true
                    else
                        esp.Name.Visible = false
                    end
                    
                    if Settings.Distance then
                        esp.DistText.Text = math.floor(distance) .. "m"
                        esp.DistText.Position = Vector2.new(headPos.X, headPos.Y + boxHeight * 0.85 + 5)
                        esp.DistText.Visible = true
                    else
                        esp.DistText.Visible = false
                    end
                else
                    esp.Box.Visible = false
                    esp.Name.Visible = false
                    esp.DistText.Visible = false
                end
                
                if Settings.Snaplines and rootOnScreen then
                    esp.Snapline.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                    esp.Snapline.To = Vector2.new(rootPos.X, rootPos.Y)
                    esp.Snapline.Visible = true
                else
                    esp.Snapline.Visible = false
                end
                
                if Settings.Skeleton and rootOnScreen then
                    local bones = character:FindFirstChild("UpperTorso") and GetBoneConnections() or GetR6BoneConnections()
                    for i, connection in ipairs(bones) do
                        local part1 = character:FindFirstChild(connection[1])
                        local part2 = character:FindFirstChild(connection[2])
                        if part1 and part2 and esp.Bones[i] then
                            local p1, v1 = Camera:WorldToViewportPoint(part1.Position)
                            local p2, v2 = Camera:WorldToViewportPoint(part2.Position)
                            if v1 and v2 then
                                esp.Bones[i].From = Vector2.new(p1.X, p1.Y)
                                esp.Bones[i].To = Vector2.new(p2.X, p2.Y)
                                esp.Bones[i].Visible = true
                            else
                                esp.Bones[i].Visible = false
                            end
                        elseif esp.Bones[i] then
                            esp.Bones[i].Visible = false
                        end
                    end
                else
                    for _, bone in pairs(esp.Bones) do
                        bone.Visible = false
                    end
                end
            else
                esp.Box.Visible = false
                esp.Snapline.Visible = false
                esp.Name.Visible = false
                esp.DistText.Visible = false
                for _, bone in pairs(esp.Bones) do
                    bone.Visible = false
                end
            end
        else
            esp.Box.Visible = false
            esp.Snapline.Visible = false
            esp.Name.Visible = false
            esp.DistText.Visible = false
            for _, bone in pairs(esp.Bones) do
                bone.Visible = false
            end
            if esp.Chams then
                esp.Chams.Adornee = nil
                esp.Chams.Parent = nil
            end
        end
    end
end

local LocalArmsHighlights = {}

local function UpdateLocalChams()
    for model, highlight in pairs(LocalArmsHighlights) do
        if not model or not model.Parent then
            pcall(function() highlight:Destroy() end)
            LocalArmsHighlights[model] = nil
        end
    end
    
    if Settings.LocalChams_Enabled then
        for _, child in pairs(Camera:GetChildren()) do
            if child:IsA("Model") then
                if not LocalArmsHighlights[child] then
                    local highlight = Instance.new("Highlight")
                    highlight.Name = "LocalArmsChams"
                    highlight.FillColor = Settings.LocalChams_Color
                    highlight.OutlineColor = Settings.LocalChams_OutlineColor
                    highlight.FillTransparency = Settings.LocalChams_FillTransparency
                    highlight.OutlineTransparency = 0
                    highlight.DepthMode = GetDepthMode(Settings.LocalChams_Mode)
                    highlight.Adornee = child
                    highlight.Parent = child
                    LocalArmsHighlights[child] = highlight
                else
                    local highlight = LocalArmsHighlights[child]
                    highlight.FillColor = Settings.LocalChams_Color
                    highlight.OutlineColor = Settings.LocalChams_OutlineColor
                    highlight.FillTransparency = Settings.LocalChams_FillTransparency
                    highlight.DepthMode = GetDepthMode(Settings.LocalChams_Mode)
                end
            end
        end
        
        local character = LocalPlayer.Character
        if character then
            for _, tool in pairs(character:GetChildren()) do
                if tool:IsA("Tool") then
                    if not LocalArmsHighlights[tool] then
                        local highlight = Instance.new("Highlight")
                        highlight.Name = "LocalArmsChams"
                        highlight.FillColor = Settings.LocalChams_Color
                        highlight.OutlineColor = Settings.LocalChams_OutlineColor
                        highlight.FillTransparency = Settings.LocalChams_FillTransparency
                        highlight.OutlineTransparency = 0
                        highlight.DepthMode = GetDepthMode(Settings.LocalChams_Mode)
                        highlight.Adornee = tool
                        highlight.Parent = tool
                        LocalArmsHighlights[tool] = highlight
                    end
                end
            end
        end
    else
        for model, highlight in pairs(LocalArmsHighlights) do
            pcall(function() highlight:Destroy() end)
        end
        LocalArmsHighlights = {}
    end
end

local function UpdateLocalCharChams()
    local character = LocalPlayer.Character
    
    if Settings.LocalCharChams_Enabled and character then
        if not LocalCharHighlight then
            LocalCharHighlight = Instance.new("Highlight")
            LocalCharHighlight.Name = "LocalCharChams"
        end
        LocalCharHighlight.FillColor = Settings.LocalCharChams_Color
        LocalCharHighlight.OutlineColor = Settings.LocalCharChams_OutlineColor
        LocalCharHighlight.FillTransparency = Settings.LocalCharChams_FillTransparency
        LocalCharHighlight.OutlineTransparency = 0
        LocalCharHighlight.DepthMode = Enum.HighlightDepthMode.Occluded
        LocalCharHighlight.Adornee = character
        LocalCharHighlight.Parent = character
    else
        if LocalCharHighlight then
            LocalCharHighlight.Adornee = nil
            LocalCharHighlight.Parent = nil
        end
    end
end

local function UpdateNightmode()
    if Settings.Nightmode then
        Lighting.Ambient = Settings.Nightmode_Color
        Lighting.OutdoorAmbient = Settings.Nightmode_Color
        Lighting.Brightness = Settings.Nightmode_Brightness
        Lighting.ClockTime = 0
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
    else
        Lighting.Ambient = OriginalLighting.Ambient
        Lighting.OutdoorAmbient = OriginalLighting.OutdoorAmbient
        Lighting.Brightness = OriginalLighting.Brightness
        Lighting.ClockTime = OriginalLighting.ClockTime
        Lighting.FogEnd = OriginalLighting.FogEnd
        Lighting.GlobalShadows = OriginalLighting.GlobalShadows
    end
end

local function UpdateSkybox()
    if Settings.Skybox_Enabled then
        local existingSky = Lighting:FindFirstChildOfClass("Sky")
        if existingSky then
            if not OriginalSky then
                OriginalSky = existingSky:Clone()
            end
            existingSky:Destroy()
        end
        
        local color = Settings.Skybox_Color
        
        local atmosphere = Lighting:FindFirstChild("CustomAtmosphere")
        if not atmosphere then
            atmosphere = Instance.new("Atmosphere")
            atmosphere.Name = "CustomAtmosphere"
            atmosphere.Parent = Lighting
        end
        
        atmosphere.Color = color
        atmosphere.Decay = color
        atmosphere.Density = 1
        atmosphere.Glare = 0
        atmosphere.Haze = 10
        
        Lighting.FogColor = color
        Lighting.FogEnd = 100000
    else
        if OriginalSky then
            local existingSky = Lighting:FindFirstChildOfClass("Sky")
            if not existingSky then
                OriginalSky:Clone().Parent = Lighting
            end
        end
        
        local atmosphere = Lighting:FindFirstChild("CustomAtmosphere")
        if atmosphere then
            atmosphere:Destroy()
        end
        
        Lighting.FogColor = OriginalLighting.FogColor or Color3.new(0.75, 0.75, 0.75)
        Lighting.FogEnd = OriginalLighting.FogEnd
    end
end

local function GetNearestBodyPart(character, screenCenter)
    local nearestPart = nil
    local nearestDist = math.huge
    
    local partsToCheck = {"Head", "UpperTorso", "LowerTorso", "HumanoidRootPart", "Torso"}
    
    for _, partName in pairs(partsToCheck) do
        local part = character:FindFirstChild(partName)
        if part then
            local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - screenCenter).Magnitude
                if dist < nearestDist then
                    nearestDist = dist
                    nearestPart = part
                end
            end
        end
    end
    
    return nearestPart
end

local function GetTargetPart(character)
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    if Settings.Aimbot_Hitbox == "Head" then
        return character:FindFirstChild("Head")
    elseif Settings.Aimbot_Hitbox == "Chest" then
        return character:FindFirstChild("UpperTorso") or character:FindFirstChild("Torso") or character:FindFirstChild("HumanoidRootPart")
    elseif Settings.Aimbot_Hitbox == "Nearest" then
        return GetNearestBodyPart(character, screenCenter)
    end
    return character:FindFirstChild("Head")
end

local function GetClosestPlayer()
    local closestPart = nil
    local shortestDist = Settings.Aimbot_FOV
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            local humanoid = character and character:FindFirstChild("Humanoid")
            
            if character and humanoid and humanoid.Health > 0 then
                local targetPart = GetTargetPart(character)
                
                if targetPart then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    if onScreen then
                        local dist = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
                        if dist < shortestDist then
                            if IsVisible(targetPart) then
                                shortestDist = dist
                                closestPart = targetPart
                            end
                        end
                    end
                end
            end
        end
    end
    
    CurrentTarget = closestPart
    return closestPart
end

UserInputService.JumpRequest:Connect(function()
    if Settings.InfiniteJump_Enabled then
        local character = LocalPlayer.Character
        local humanoid = character and character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

local function UpdateSpeedHack()
    local character = LocalPlayer.Character
    local humanoid = character and character:FindFirstChildOfClass("Humanoid")
    
    if humanoid then
        if Settings.SpeedHack_Enabled then
            humanoid.WalkSpeed = Settings.SpeedHack_Speed
        end
    end
end

local function StartFly()
    local character = LocalPlayer.Character
    local humanoid = character and character:FindFirstChildOfClass("Humanoid")
    local rootPart = character and character:FindFirstChild("HumanoidRootPart")
    
    if not character or not humanoid or not rootPart then return end
    
    flyActive = true
    
    flyBodyVelocity = Instance.new("BodyVelocity")
    flyBodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    flyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
    flyBodyVelocity.Parent = rootPart
    
    flyBodyGyro = Instance.new("BodyGyro")
    flyBodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    flyBodyGyro.P = 9e4
    flyBodyGyro.CFrame = rootPart.CFrame
    flyBodyGyro.Parent = rootPart
    
    humanoid.PlatformStand = true
end

local function StopFly()
    flyActive = false
    
    local character = LocalPlayer.Character
    local humanoid = character and character:FindFirstChildOfClass("Humanoid")
    
    if flyBodyVelocity then
        flyBodyVelocity:Destroy()
        flyBodyVelocity = nil
    end
    
    if flyBodyGyro then
        flyBodyGyro:Destroy()
        flyBodyGyro = nil
    end
    
    if humanoid then
        humanoid.PlatformStand = false
    end
end

local function UpdateFly()
    if not flyActive or not flyBodyVelocity or not flyBodyGyro then return end
    
    local character = LocalPlayer.Character
    local rootPart = character and character:FindFirstChild("HumanoidRootPart")
    
    if not rootPart then 
        StopFly()
        return 
    end
    
    local speed = Settings.Fly_Speed
    local direction = Vector3.new(0, 0, 0)
    
    local camCF = Camera.CFrame
    local lookVector = camCF.LookVector
    local rightVector = camCF.RightVector
    
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
        direction = direction + lookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
        direction = direction - lookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
        direction = direction - rightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
        direction = direction + rightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
        direction = direction + Vector3.new(0, 1, 0)
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) or UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
        direction = direction - Vector3.new(0, 1, 0)
    end
    
    if direction.Magnitude > 0 then
        direction = direction.Unit
    end
    
    flyBodyVelocity.Velocity = direction * speed
    flyBodyGyro.CFrame = camCF
end

local function ToggleFly()
    if flyActive then
        StopFly()
    else
        StartFly()
    end
end

local function UpdateGhost()
    if Settings.Ghost_Enabled then
        local character = LocalPlayer.Character
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end
end

local function UpdateSpinBot()
    if Settings.SpinBot_Enabled then
        local character = LocalPlayer.Character
        local humanoidRootPart = character and character:FindFirstChild("HumanoidRootPart")
        
        if humanoidRootPart then
            spinAngle = spinAngle + Settings.SpinBot_Speed
            if spinAngle >= 360 then
                spinAngle = 0
            end
            
            local currentCFrame = humanoidRootPart.CFrame
            local newCFrame = CFrame.new(currentCFrame.Position) * CFrame.Angles(0, math.rad(spinAngle), 0)
            humanoidRootPart.CFrame = newCFrame
        end
    end
end

local function UpdateRadar()
    RadarFrame.Visible = Settings.Radar_Enabled
    RadarFrame.Size = UDim2.new(0, Settings.Radar_Size, 0, Settings.Radar_Size)
    RadarFrame.Position = UDim2.new(1, -Settings.Radar_Size - 10, 0, 10)
    
    if not Settings.Radar_Enabled then
        for _, dot in pairs(RadarDots) do
            dot:Destroy()
        end
        RadarDots = {}
        return
    end
    
    local myChar = LocalPlayer.Character
    local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")
    
    if not myRoot then return end
    
    local myPos = myRoot.Position
    local myLook = Camera.CFrame.LookVector
    
    local radarScale = Settings.Radar_Size / 2
    local worldScale = 100 / Settings.Radar_Zoom
    
    local playerIndex = 1
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            local rootPart = character and character:FindFirstChild("HumanoidRootPart")
            local humanoid = character and character:FindFirstChild("Humanoid")
            
            if character and rootPart and humanoid and humanoid.Health > 0 then
                local relativePos = rootPart.Position - myPos
                
                local angle = math.atan2(myLook.X, myLook.Z)
                local rotatedX = relativePos.X * math.cos(angle) - relativePos.Z * math.sin(angle)
                local rotatedZ = relativePos.X * math.sin(angle) + relativePos.Z * math.cos(angle)
                
                local radarX = math.clamp(rotatedX / worldScale, -1, 1) * (radarScale - 5)
                local radarY = math.clamp(-rotatedZ / worldScale, -1, 1) * (radarScale - 5)
                
                if not RadarDots[playerIndex] then
                    local dot = Instance.new("Frame")
                    dot.Size = UDim2.new(0, 6, 0, 6)
                    dot.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                    dot.BorderSizePixel = 0
                    dot.Parent = RadarFrame
                    
                    local dotCorner = Instance.new("UICorner")
                    dotCorner.CornerRadius = UDim.new(1, 0)
                    dotCorner.Parent = dot
                    
                    RadarDots[playerIndex] = dot
                end
                
                RadarDots[playerIndex].Position = UDim2.new(0.5, radarX - 3, 0.5, radarY - 3)
                RadarDots[playerIndex].Visible = true
                
                playerIndex = playerIndex + 1
            end
        end
    end
    
    for i = playerIndex, #RadarDots do
        if RadarDots[i] then
            RadarDots[i].Visible = false
        end
    end
end

local function UpdateWeaponMods()
    local character = LocalPlayer.Character
    if not character then return end
    
    for _, tool in pairs(character:GetChildren()) do
        if tool:IsA("Tool") then
            if Settings.NoReload_Enabled then
                for _, child in pairs(tool:GetDescendants()) do
                    if child:IsA("ModuleScript") or child:IsA("LocalScript") then
                        pcall(function()
                            if child.Name:lower():find("reload") then
                                child.Disabled = true
                            end
                        end)
                    end
                end
                
                pcall(function()
                    local ammo = tool:FindFirstChild("Ammo") or tool:FindFirstChild("CurrentAmmo") or tool:FindFirstChild("Bullets")
                    if ammo and ammo:IsA("ValueBase") then
                        ammo.Value = 999
                    end
                end)
            end
        end
    end
end

local function AutoFire()
    if Settings.AutoFire_Enabled and CurrentTarget and aimbotActive then
        pcall(function()
            local vim = game:GetService("VirtualInputManager")
            vim:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            task.wait(0.01)
            vim:SendMouseButtonEvent(0, 0, 0, false, game, 0)
        end)
        
        pcall(function()
            mouse1click()
        end)
    end
end

local function RapidFire()
    if Settings.RapidFire_Enabled then
        local character = LocalPlayer.Character
        if not character then return end
        
        for _, tool in pairs(character:GetChildren()) do
            if tool:IsA("Tool") then
                pcall(function()
                    for _, child in pairs(tool:GetDescendants()) do
                        if child.Name:lower():find("firerate") or child.Name:lower():find("fire_rate") or child.Name:lower():find("cooldown") then
                            if child:IsA("NumberValue") or child:IsA("IntValue") then
                                child.Value = child.Value / Settings.RapidFire_Multiplier
                            end
                        end
                    end
                end)
            end
        end
    end
end

local function ToggleMenu()
    MenuOpen = not MenuOpen
    MainFrame.Visible = MenuOpen
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.RightShift then
        ToggleMenu()
        return
    end
    
    if gameProcessed then return end
    
    if input.KeyCode == Settings.Thirdperson_Key then
        Settings.Thirdperson_Enabled = not Settings.Thirdperson_Enabled
        if Settings.Thirdperson_Enabled then
            LocalPlayer.CameraMinZoomDistance = Settings.Thirdperson_Distance
            LocalPlayer.CameraMaxZoomDistance = Settings.Thirdperson_Distance
        else
            LocalPlayer.CameraMinZoomDistance = 0.5
            LocalPlayer.CameraMaxZoomDistance = 400
        end
    end
    
    if input.KeyCode == Settings.Fly_Key and Settings.Fly_Enabled then
        ToggleFly()
    end
    
    if input.KeyCode == Settings.Aimbot_Key then
        aimbotActive = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Settings.Aimbot_Key then
        aimbotActive = false
        CurrentTarget = nil
    end
end)

RunService.RenderStepped:Connect(function()
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    FOVCircle.Position = screenCenter
    FOVCircle.Radius = Settings.Aimbot_FOV
    FOVCircle.Visible = Settings.Aimbot_Enabled and not MenuOpen
    
    Camera.FieldOfView = Settings.FOV_Changer
    
    UpdateESP()
    UpdateLocalChams()
    UpdateLocalCharChams()
    UpdateNightmode()
    UpdateSkybox()
    UpdateSpeedHack()
    UpdateFly()
    UpdateGhost()
    UpdateSpinBot()
    UpdateRadar()
    UpdateWeaponMods()
    RapidFire()
    
    if Settings.Aimbot_TargetLine and CurrentTarget and aimbotActive then
        local targetPos, onScreen = Camera:WorldToViewportPoint(CurrentTarget.Position)
        if onScreen then
            TargetLine.From = screenCenter
            TargetLine.To = Vector2.new(targetPos.X, targetPos.Y)
            TargetLine.Visible = true
        else
            TargetLine.Visible = false
        end
    else
        TargetLine.Visible = false
    end
    
    if Settings.Aimbot_Enabled and aimbotActive and not MenuOpen then
        local target = GetClosestPlayer()
        if target then
            local targetPos = Camera:WorldToViewportPoint(target.Position)
            if targetPos.Z > 0 then
                local aimPos = Vector2.new(targetPos.X, targetPos.Y)
                local deltaX = aimPos.X - screenCenter.X
                local deltaY = aimPos.Y - screenCenter.Y
                local distance = math.sqrt(deltaX * deltaX + deltaY * deltaY)
                
                if distance > 1 then
                    local smoothness = math.max(Settings.Aimbot_Smoothness, 1)
                    local moveX = deltaX / smoothness
                    local moveY = deltaY / smoothness
                    
                    local maxMove = math.min(100, distance * 0.8)
                    local moveMagnitude = math.sqrt(moveX * moveX + moveY * moveY)
                    
                    if moveMagnitude > maxMove then
                        local scale = maxMove / moveMagnitude
                        moveX = moveX * scale
                        moveY = moveY * scale
                    end
                    
                    if math.abs(moveX) > 0.1 or math.abs(moveY) > 0.1 then
                        if mousemoverel then
                            mousemoverel(moveX, moveY)
                        end
                    end
                end
                
                AutoFire()
            end
        end
    end
end)

RunService.Stepped:Connect(function()
    if flyActive then
        local character = LocalPlayer.Character
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end
    
    UpdateGhost()
end)

for _, player in pairs(Players:GetPlayers()) do
    CreateESP(player)
end

Players.PlayerAdded:Connect(CreateESP)

Players.PlayerRemoving:Connect(function(player)
    if ESPObjects[player] then
        pcall(function()
            for _, v in pairs(ESPObjects[player].Bones) do v:Remove() end
            ESPObjects[player].Box:Remove()
            ESPObjects[player].Snapline:Remove()
            ESPObjects[player].Name:Remove()
            ESPObjects[player].DistText:Remove()
            if ESPObjects[player].Chams then ESPObjects[player].Chams:Destroy() end
        end)
        ESPObjects[player] = nil
    end
end)

LocalPlayer.CharacterAdded:Connect(function(char)
    task.wait(1)
    
    if flyActive then
        StopFly()
    end
    
    UpdateLocalCharChams()
    UpdateLocalChams()
    
    if Settings.Thirdperson_Enabled then
        LocalPlayer.CameraMinZoomDistance = Settings.Thirdperson_Distance
        LocalPlayer.CameraMaxZoomDistance = Settings.Thirdperson_Distance
    end
end)

local KeybindsList = Instance.new("Frame")
KeybindsList.Name = "KeybindsList"
KeybindsList.Size = UDim2.new(0, 180, 0, 200)
KeybindsList.Position = UDim2.new(0, 10, 0.5, -100)
KeybindsList.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
KeybindsList.BackgroundTransparency = 0.2
KeybindsList.BorderSizePixel = 0
KeybindsList.Visible = true
KeybindsList.Parent = ScreenGui

local KeybindsCorner = Instance.new("UICorner")
KeybindsCorner.CornerRadius = UDim.new(0, 8)
KeybindsCorner.Parent = KeybindsList

local KeybindsTitle = Instance.new("TextLabel")
KeybindsTitle.Size = UDim2.new(1, 0, 0, 25)
KeybindsTitle.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
KeybindsTitle.Text = "  Active Features"
KeybindsTitle.TextColor3 = Color3.new(1, 1, 1)
KeybindsTitle.Font = Enum.Font.GothamBold
KeybindsTitle.TextSize = 12
KeybindsTitle.TextXAlignment = Enum.TextXAlignment.Left
KeybindsTitle.Parent = KeybindsList

local KeybindsTitleCorner = Instance.new("UICorner")
KeybindsTitleCorner.CornerRadius = UDim.new(0, 8)
KeybindsTitleCorner.Parent = KeybindsTitle

local KeybindsTitleFix = Instance.new("Frame")
KeybindsTitleFix.Size = UDim2.new(1, 0, 0, 8)
KeybindsTitleFix.Position = UDim2.new(0, 0, 1, -8)
KeybindsTitleFix.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
KeybindsTitleFix.BorderSizePixel = 0
KeybindsTitleFix.Parent = KeybindsTitle

local KeybindsContent = Instance.new("ScrollingFrame")
KeybindsContent.Size = UDim2.new(1, -10, 1, -35)
KeybindsContent.Position = UDim2.new(0, 5, 0, 30)
KeybindsContent.BackgroundTransparency = 1
KeybindsContent.ScrollBarThickness = 3
KeybindsContent.ScrollBarImageColor3 = Color3.fromRGB(128, 0, 128)
KeybindsContent.CanvasSize = UDim2.new(0, 0, 0, 0)
KeybindsContent.Parent = KeybindsList

local KeybindsLayout = Instance.new("UIListLayout")
KeybindsLayout.Padding = UDim.new(0, 2)
KeybindsLayout.Parent = KeybindsContent

KeybindsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    KeybindsContent.CanvasSize = UDim2.new(0, 0, 0, KeybindsLayout.AbsoluteContentSize.Y + 5)
    KeybindsList.Size = UDim2.new(0, 180, 0, math.min(300, KeybindsLayout.AbsoluteContentSize.Y + 40))
end)

local ActiveFeatures = {}

local function UpdateKeybindsList()
    for _, child in pairs(KeybindsContent:GetChildren()) do
        if child:IsA("TextLabel") then
            child:Destroy()
        end
    end
    
    local features = {}
    
    if Settings.Aimbot_Enabled then
        table.insert(features, {name = "Aimbot", key = Settings.Aimbot_Key.Name, color = Color3.fromRGB(255, 100, 100)})
    end
    if Settings.ESP_Enabled then
        table.insert(features, {name = "ESP", key = "ON", color = Color3.fromRGB(100, 255, 100)})
    end
    if Settings.Chams_Enabled then
        table.insert(features, {name = "Chams", key = "ON", color = Color3.fromRGB(100, 100, 255)})
    end
    if Settings.AutoFire_Enabled then
        table.insert(features, {name = "Auto Fire", key = "ON", color = Color3.fromRGB(255, 200, 100)})
    end
    if Settings.SpinBot_Enabled then
        table.insert(features, {name = "SpinBot [R]", key = "ON", color = Color3.fromRGB(255, 50, 50)})
    end
    if Settings.Thirdperson_Enabled then
        table.insert(features, {name = "Thirdperson", key = Settings.Thirdperson_Key.Name, color = Color3.fromRGB(150, 150, 255)})
    end
    if Settings.Fly_Enabled then
        table.insert(features, {name = "Fly [R]", key = Settings.Fly_Key.Name, color = Color3.fromRGB(255, 150, 50)})
    end
    if flyActive then
        table.insert(features, {name = "Flying", key = "ACTIVE", color = Color3.fromRGB(255, 255, 0)})
    end
    if Settings.Ghost_Enabled then
        table.insert(features, {name = "Ghost [R]", key = "ON", color = Color3.fromRGB(200, 100, 255)})
    end
    if Settings.SpeedHack_Enabled then
        table.insert(features, {name = "Speed [R]", key = tostring(Settings.SpeedHack_Speed), color = Color3.fromRGB(100, 255, 200)})
    end
    if Settings.InfiniteJump_Enabled then
        table.insert(features, {name = "Inf Jump", key = "ON", color = Color3.fromRGB(200, 255, 100)})
    end
    if Settings.RapidFire_Enabled then
        table.insert(features, {name = "RapidFire [R]", key = "x" .. tostring(Settings.RapidFire_Multiplier), color = Color3.fromRGB(255, 100, 150)})
    end
    if Settings.NoReload_Enabled then
        table.insert(features, {name = "No Reload [R]", key = "ON", color = Color3.fromRGB(255, 150, 200)})
    end
    if Settings.Radar_Enabled then
        table.insert(features, {name = "Radar", key = "ON", color = Color3.fromRGB(100, 200, 255)})
    end
    if Settings.Nightmode then
        table.insert(features, {name = "Nightmode", key = "ON", color = Color3.fromRGB(80, 80, 150)})
    end
    
    for _, feature in ipairs(features) do
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 0, 18)
        label.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        label.BackgroundTransparency = 0.5
        label.Text = "  " .. feature.name
        label.TextColor3 = feature.color
        label.Font = Enum.Font.Gotham
        label.TextSize = 11
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Parent = KeybindsContent
        
        local labelCorner = Instance.new("UICorner")
        labelCorner.CornerRadius = UDim.new(0, 4)
        labelCorner.Parent = label
        
        local keyLabel = Instance.new("TextLabel")
        keyLabel.Size = UDim2.new(0, 40, 1, 0)
        keyLabel.Position = UDim2.new(1, -45, 0, 0)
        keyLabel.BackgroundTransparency = 1
        keyLabel.Text = "[" .. feature.key .. "]"
        keyLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
        keyLabel.Font = Enum.Font.Code
        keyLabel.TextSize = 9
        keyLabel.Parent = label
    end
    
    if #features == 0 then
        local noFeatures = Instance.new("TextLabel")
        noFeatures.Size = UDim2.new(1, 0, 0, 18)
        noFeatures.BackgroundTransparency = 1
        noFeatures.Text = "  No active features"
        noFeatures.TextColor3 = Color3.fromRGB(100, 100, 100)
        noFeatures.Font = Enum.Font.Gotham
        noFeatures.TextSize = 10
        noFeatures.TextXAlignment = Enum.TextXAlignment.Left
        noFeatures.Parent = KeybindsContent
    end
end

local keybindsUpdateCounter = 0
RunService.Heartbeat:Connect(function()
    keybindsUpdateCounter = keybindsUpdateCounter + 1
    if keybindsUpdateCounter >= 10 then
        keybindsUpdateCounter = 0
        UpdateKeybindsList()
    end
    
    if MenuOpen then
        pcall(function()
            UserInputService.MouseBehavior = Enum.MouseBehavior.Default
            UserInputService.MouseIconEnabled = true
        end)
    end
end)

local WatermarkFrame = Instance.new("Frame")
WatermarkFrame.Name = "Watermark"
WatermarkFrame.Size = UDim2.new(0, 250, 0, 30)
WatermarkFrame.Position = UDim2.new(0.5, -125, 0, 10)
WatermarkFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
WatermarkFrame.BackgroundTransparency = 0.3
WatermarkFrame.BorderSizePixel = 0
WatermarkFrame.Parent = ScreenGui

local WatermarkCorner = Instance.new("UICorner")
WatermarkCorner.CornerRadius = UDim.new(0, 6)
WatermarkCorner.Parent = WatermarkFrame

local WatermarkGradient = Instance.new("UIGradient")
WatermarkGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(128, 0, 128)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(80, 0, 80)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(128, 0, 128))
})
WatermarkGradient.Parent = WatermarkFrame

local WatermarkText = Instance.new("TextLabel")
WatermarkText.Size = UDim2.new(1, 0, 1, 0)
WatermarkText.BackgroundTransparency = 1
WatermarkText.Text = "OpusLose v6 | FPS: 0 | Ping: 0ms"
WatermarkText.TextColor3 = Color3.new(1, 1, 1)
WatermarkText.Font = Enum.Font.GothamBold
WatermarkText.TextSize = 12
WatermarkText.Parent = WatermarkFrame

local Stats = game:GetService("Stats")

task.spawn(function()
    while task.wait(0.5) do
        local fps = math.floor(1 / RunService.RenderStepped:Wait())
        local ping = math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())
        WatermarkText.Text = string.format("OpusLose v6 | FPS: %d | Ping: %dms", fps, ping)
    end
end)

local CrosshairV = Drawing.new("Line")
CrosshairV.Color = Color3.fromRGB(255, 255, 255)
CrosshairV.Thickness = 1
CrosshairV.Visible = true

local CrosshairH = Drawing.new("Line")
CrosshairH.Color = Color3.fromRGB(255, 255, 255)
CrosshairH.Thickness = 1
CrosshairH.Visible = true

RunService.RenderStepped:Connect(function()
    local center = Camera.ViewportSize / 2
    
    CrosshairV.From = Vector2.new(center.X, center.Y - 8)
    CrosshairV.To = Vector2.new(center.X, center.Y + 8)
    
    CrosshairH.From = Vector2.new(center.X - 8, center.Y)
    CrosshairH.To = Vector2.new(center.X + 8, center.Y)
end)

local TargetInfoFrame = Instance.new("Frame")
TargetInfoFrame.Name = "TargetInfo"
TargetInfoFrame.Size = UDim2.new(0, 150, 0, 60)
TargetInfoFrame.Position = UDim2.new(0.5, -75, 0, 50)
TargetInfoFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TargetInfoFrame.BackgroundTransparency = 0.3
TargetInfoFrame.BorderSizePixel = 0
TargetInfoFrame.Visible = false
TargetInfoFrame.Parent = ScreenGui

local TargetInfoCorner = Instance.new("UICorner")
TargetInfoCorner.CornerRadius = UDim.new(0, 6)
TargetInfoCorner.Parent = TargetInfoFrame

local TargetNameLabel = Instance.new("TextLabel")
TargetNameLabel.Size = UDim2.new(1, 0, 0, 20)
TargetNameLabel.Position = UDim2.new(0, 0, 0, 5)
TargetNameLabel.BackgroundTransparency = 1
TargetNameLabel.Text = "Target: None"
TargetNameLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
TargetNameLabel.Font = Enum.Font.GothamBold
TargetNameLabel.TextSize = 12
TargetNameLabel.Parent = TargetInfoFrame

local TargetHealthLabel = Instance.new("TextLabel")
TargetHealthLabel.Size = UDim2.new(1, 0, 0, 20)
TargetHealthLabel.Position = UDim2.new(0, 0, 0, 25)
TargetHealthLabel.BackgroundTransparency = 1
TargetHealthLabel.Text = "Health: 0"
TargetHealthLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
TargetHealthLabel.Font = Enum.Font.Gotham
TargetHealthLabel.TextSize = 11
TargetHealthLabel.Parent = TargetInfoFrame

local TargetDistLabel = Instance.new("TextLabel")
TargetDistLabel.Size = UDim2.new(1, 0, 0, 20)
TargetDistLabel.Position = UDim2.new(0, 0, 0, 40)
TargetDistLabel.BackgroundTransparency = 1
TargetDistLabel.Text = "Distance: 0m"
TargetDistLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
TargetDistLabel.Font = Enum.Font.Gotham
TargetDistLabel.TextSize = 11
TargetDistLabel.Parent = TargetInfoFrame

RunService.Heartbeat:Connect(function()
    if CurrentTarget and aimbotActive then
        TargetInfoFrame.Visible = true
        
        local character = CurrentTarget.Parent
        local humanoid = character and character:FindFirstChild("Humanoid")
        local player = Players:GetPlayerFromCharacter(character)
        
        if player and humanoid then
            TargetNameLabel.Text = "Target: " .. player.Name
            TargetHealthLabel.Text = string.format("Health: %d/%d", math.floor(humanoid.Health), math.floor(humanoid.MaxHealth))
            
            local myChar = LocalPlayer.Character
            local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")
            if myRoot then
                local dist = (myRoot.Position - CurrentTarget.Position).Magnitude
                TargetDistLabel.Text = string.format("Distance: %dm", math.floor(dist))
            end
        end
    else
        TargetInfoFrame.Visible = false
    end
end)

local NotificationHolder = Instance.new("Frame")
NotificationHolder.Name = "Notifications"
NotificationHolder.Size = UDim2.new(0, 250, 1, 0)
NotificationHolder.Position = UDim2.new(1, -260, 0, 50)
NotificationHolder.BackgroundTransparency = 1
NotificationHolder.Parent = ScreenGui

local NotificationLayout = Instance.new("UIListLayout")
NotificationLayout.Padding = UDim.new(0, 5)
NotificationLayout.VerticalAlignment = Enum.VerticalAlignment.Top
NotificationLayout.Parent = NotificationHolder

local function Notify(title, message, duration)
    duration = duration or 3
    
    local notif = Instance.new("Frame")
    notif.Size = UDim2.new(1, 0, 0, 50)
    notif.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    notif.BackgroundTransparency = 0.2
    notif.BorderSizePixel = 0
    notif.Parent = NotificationHolder
    
    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0, 6)
    notifCorner.Parent = notif
    
    local accent = Instance.new("Frame")
    accent.Size = UDim2.new(0, 4, 1, 0)
    accent.BackgroundColor3 = Color3.fromRGB(128, 0, 128)
    accent.BorderSizePixel = 0
    accent.Parent = notif
    
    local accentCorner = Instance.new("UICorner")
    accentCorner.CornerRadius = UDim.new(0, 6)
    accentCorner.Parent = accent
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -15, 0, 20)
    titleLabel.Position = UDim2.new(0, 10, 0, 5)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(128, 0, 128)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 12
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = notif
    
    local msgLabel = Instance.new("TextLabel")
    msgLabel.Size = UDim2.new(1, -15, 0, 20)
    msgLabel.Position = UDim2.new(0, 10, 0, 25)
    msgLabel.BackgroundTransparency = 1
    msgLabel.Text = message
    msgLabel.TextColor3 = Color3.new(1, 1, 1)
    msgLabel.Font = Enum.Font.Gotham
    msgLabel.TextSize = 11
    msgLabel.TextXAlignment = Enum.TextXAlignment.Left
    msgLabel.Parent = notif
    
    task.spawn(function()
        task.wait(duration)
        for i = 0, 1, 0.1 do
            notif.BackgroundTransparency = 0.2 + (i * 0.8)
            titleLabel.TextTransparency = i
            msgLabel.TextTransparency = i
            accent.BackgroundTransparency = i
            task.wait(0.02)
        end
        notif:Destroy()
    end)
end

task.spawn(function()
    task.wait(1)
    
    UpdateNightmode()
    UpdateSkybox()
    UpdateLocalChams()
    UpdateLocalCharChams()
    UpdateKeybindsList()
    
    Notify("OpusLose", "Script loaded successfully!", 3)
    Notify("Keybinds", "RightShift - Menu | Q - Aimbot", 4)
    
    print("=====================================")
    print("  OpusLose v6 Ultimate - Loaded!")
    print("=====================================")
    print("  RightShift - Open/Close Menu")
    print("  Q (hold) - Aimbot")
    print("  T - Toggle Thirdperson")
    print("  F - Toggle Fly")
    print("=====================================")
    print("  [R] = Risky Feature (Detectable)")
    print("=====================================")
end)

local oldThirdperson = Settings.Thirdperson_Enabled
local oldFly = flyActive
local oldGhost = Settings.Ghost_Enabled
local oldSpinbot = Settings.SpinBot_Enabled

task.spawn(function()
    while task.wait(0.5) do
        if Settings.Thirdperson_Enabled ~= oldThirdperson then
            oldThirdperson = Settings.Thirdperson_Enabled
            if Settings.Thirdperson_Enabled then
                Notify("Thirdperson", "Enabled", 2)
            else
                Notify("Thirdperson", "Disabled", 2)
            end
        end
        
        if flyActive ~= oldFly then
            oldFly = flyActive
            if flyActive then
                Notify("Fly", "Enabled - Use WASD to move", 2)
            else
                Notify("Fly", "Disabled", 2)
            end
        end
        
        if Settings.Ghost_Enabled ~= oldGhost then
            oldGhost = Settings.Ghost_Enabled
            if Settings.Ghost_Enabled then
                Notify("Ghost", "Enabled - You can walk through walls", 2)
            else
                Notify("Ghost", "Disabled", 2)
            end
        end
        
        if Settings.SpinBot_Enabled ~= oldSpinbot then
            oldSpinbot = Settings.SpinBot_Enabled
            if Settings.SpinBot_Enabled then
                Notify("SpinBot", "Enabled - [RISKY]", 2)
            else
                Notify("SpinBot", "Disabled", 2)
            end
        end
    end
end)

local keysDragging = false
local keysDragStart = nil
local keysStartPos = nil

KeybindsTitle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        keysDragging = true
        keysDragStart = input.Position
        keysStartPos = KeybindsList.Position
    end
end)

KeybindsTitle.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        keysDragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if keysDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - keysDragStart
        KeybindsList.Position = UDim2.new(keysStartPos.X.Scale, keysStartPos.X.Offset + delta.X, keysStartPos.Y.Scale, keysStartPos.Y.Offset + delta.Y)
    end
end)

local radarDragging = false
local radarDragStart = nil
local radarStartPos = nil

RadarFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        radarDragging = true
        radarDragStart = input.Position
        radarStartPos = RadarFrame.Position
    end
end)

RadarFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        radarDragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if radarDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - radarDragStart
        RadarFrame.Position = UDim2.new(radarStartPos.X.Scale, radarStartPos.X.Offset + delta.X, radarStartPos.Y.Scale, radarStartPos.Y.Offset + delta.Y)
    end
end)